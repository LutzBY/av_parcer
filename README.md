Привет!
Перед вами система сбора, очистки, хранения, апдейта и анализа предложений с moto.av.by

В корне папки с иполняемыми скриптами должен содержаться файл config.json с кредами базы и почтами для отправки отчета
Также должен содержаться файл exceptions.json к которому обращаются скрипты для получения списка стран, марок и продавцов для логики исключений и флагов
База хостится на postgres, бекап на данный момент выполняется с помощью pg_dump по расписанию на уровне виртуальной машины строкой "pg_dump -U user -d testdb -Z 9 > /mnt/backup/backup-$(date +%d-%m-%y-%H-%M-%S).gz"
Реализован автоматический гит пуллер (скрипт gitsync) на виртуальной машине (раз в сутки)

Папка dev содержит рабочие промежуточные файлы

Корневая папка содержит:
avparser - скрипт парсера moto.av.by. Получает json страницы через BS4 и requests, корректирует полученные данные. Выполняет дополнение vlk (более точное описание модели по референс-базе). Выполняет проверку на дубликаты в базе (есть ли аналогичные объявления от такого же человека), выводит их в удобном виде в email-отчете для ручной проверки. Пишет полученные строки в базу на postgresql. Собирает дополнительную информацию для отчета и формирует отчет в виде html с картинками и статистикой. Отсылает этот отчет на указанные в config адреса. Запускается два раза в день по расписанию в автоматическом режиме. Реализована функция поиска модели через openai chat.completions

actcheck - скрипт актуализации и дополнения данных в базе. Выбирает строки для проверки актуальности объявлений (проверка на закрыто / продано и т.д.). Выполняет автопроверку на дубликаты в базе (более строгие условия, чем у avparser) и помечает их. Собирает историю изменения цен в отдельную базу
После завершения формирует отчет и направляет его на указанные в config почты.
Дополнительно, при обнаружении новых продавцов-юрлиц, которых еще нет в отдельной базе, проводит парсинг информации по недостающим.
Функция получения номеров телефонов продавца по api приостановлена, т.к. av теперь требует x-api-key, уникальный для каждого пользователя, верифицированного по номеру телефона.

onlparser - простой парсер moto.onliner.by. Пишет в постгре, отчитывается на почту

gui_redactor - утилитка с gui (tkinter) для ручного обслуживания и корректирования базы. Позволяет запустить функцию поиска vlk по искомому id, записать / скопировать новое vlk, установить флаги, удалить запись. Имеется функция пометки дубликатов и изменения определенных значений с последующим поиском vlk заново. Также умеет запускать поиск по llm, если его нужно уточнить и вручную получить номер телефона по конкретному объявлению. Утилитка разработана для упрощения регулярной ручной работы, правок ошибок ввода пользователей, ручной пометки дубликатов и изменения неправильно присвоенного влк (как mvlk (который базазнаний->fuzzywuzzy) так и mvlk_llm (chat.completions)).




